# 公开课笔记 AI 导读与翻译助手 - 开发文档

## 1. 项目背景与目标
针对现有网页翻译插件在阅读英文公开课笔记（如 CS231n）时存在的**术语不准**、**缺乏全局上下文概括**、**排版容易错乱**等痛点，本项目旨在通过 Python 脚本结合大语言模型（LLM）能力，开发一款“AI 学长”级别的导读与翻译工具。

目标产物不是单纯的中英词汇替换，而是一份**包含高质量翻译、核心大纲、难点批注且排版精良的精读学习笔记**。

## 2. 核心设计理念 (Prompt Engineering)
本项目在 Prompt 设计上遵循“**释放思想，锁死格式**”的黄金法则：
*   **意图优先（发散思想）**：不对大模型的翻译过程做死板的机械限制（如“先翻译主谓词”）。将其角色设定为“精通该领域的双语教授”或“带读学长”，让其将注意力集中在**内容质量把关**和**知识点深度讲解**上，输出具有人情味的学习内容。
*   **格式红线（收敛规则）**：必须通过强 Prompt 限制或代码层面的正则替换，绝对保护所有 LaTeX 数学公式（`$...$`）、Markdown 代码块（` ```...``` `）以及标题列表等结构不被破坏、不被机翻。

## 3. 整体系统架构 (Map-Reduce 范式)
项目弃用了直接喂长文本的低效模式，采用 **“先通读大纲后局部精读 (Plan-and-Execute)”** 两步走架构，完美解决长文档翻译中的上下文断裂问题：

### Step 0: 网页内容获取与 Markdown 化
*   **方案**：坚决摒弃 PDF，拥抱大模型最友好的 Markdown 格式。采用专为 LLM 设计的文档阅读接口（如 **Jina Reader**）。
*   **流程**：Python 接收公开课 URL -> 拼接为 `https://r.jina.ai/[URL]` 请求 -> 获取剥离了网页前端噪音（导航条、侧栏广告）的极净结构化 Markdown 正文。

### Step 1: 全局粗读与大纲提取 (Global Profiling)
*   **输入**：全篇纯净的 Markdown 文本。
*   **流程**：调用一次大模型进行全局“粗读”。
*   **输出（暂存变量）**：
    1.  **全局大纲（Draft/Outline）**：梳理出全文的逻辑脉络。
    2.  **核心术语表（Glossary）**：提取文章中的专有名词，并推荐标准中文译法，作为后续精翻的全局锚点。

### Step 2: 局部精细翻译与批注补充 (Iterative Translation)
*   **文本切块 (Chunking)**：Python 脚本按照 Markdown 的标题级别（如基于 `## ` 的正则切分）将全篇切分为多个逻辑段落块 (Chunks)。
*   **循环调用 LLM**：将 `[Step 1全局大纲]` + `[Step 1术语表]` + `[当前段落原文]` 拼接，送给大模型进行精读。
*   **输出目标**：
    1.  按照统一术语表完成本段的精准翻译。
    2.  对本段枯燥或晦涩的难点主动添加【学习批注】或【背景知识扩展】。
    3.  精准遵循原文的 Markdown 结构。

### Step 3: 内容拼装与落盘 (Output)
*   **流程**：Python 脚本将循环输出的 Chunk 翻译与批注拼接起来，并追加 Step 1 提取的全局大纲。然后写入本地文件系统（如生成 `translated_note.md`），即刻可用 Typora 等阅读器查看。

## 4. 技术栈选型建议
*   **核心语言**：Python 3.x
*   **网络请求**：`requests` 库（轻量、稳定）。
*   **文本处理**：`re` 正则表达式模块（用于占位隔离代码块或基于 Markdown 符号进行长文切片）。
*   **LLM API**：强烈建议选择对 Markdown 格式遵循度极高且带有强推理能力的模型（如 Claude 3.5 Sonnet, GPT-4o 或 DeepSeek 等）。

## 5. 常见坑点与防范 (Troubleshooting)
1.  **代码/公式被强行翻译（灾难级问题）**：
    *   **应对手段**：如果在 Prompt 中强调无效，需在 Python 传给 LLM 之前，用正则表达式把 `$公式$` 和 ` ```代码``` ` 提取并替换成 `<UUID_1>` 等无意义占位符。收到 LLM 的翻译结果后，再安全地替换还原回去。
2.  **大模型的“理直气壮式幻觉”**：
    *   **应对手段**：在生成“学习批注”时，Prompt 必须强调纪律：“批注内容需严格基于公认的学科基础知识。若对非常偏门的算法缺乏把握，请直接标明‘（注：此处可能需要参考其他权威来源）’，严禁捏造虚假原理”。
3.  **API Rate Limit (并发限流)**：
    *   **应对手段**：由于是切块循环调用，API 极易触发频控（HTTP 429）。务必在 Python `for` 循环中加入 `time.sleep()` 延迟，或使用 `tenacity` 库实现带退避策略的自动重试。
